import{defineComponent as m,ref as p,computed as d,h as s,nextTick as O,onMounted as E}from"vue";import{usePageFrontmatter as T,usePageData as k}from"vuepress/client";import{L as _}from"../../icons-BBxJRXot.js";import{u as w,a as x,b as G}from"../../usePure-B1lKNvWK.js";import{RenderDefault as H}from"vuepress-shared/client";import{useStorage as h,useSessionStorage as b}from"@vueuse/core";import{compareSync as f}from"bcrypt-ts/browser";import{F as K}from"../../FadeSlideY-DXWaZ1LE.js";import{isPlainObject as R,keys as V,startsWith as j}from"@vuepress/helper/client";import"@vuepress/plugin-theme-data/client";var g=m({name:"PasswordModal",props:{full:Boolean},emits:["verify"],setup(l,{emit:a}){const r=T(),n=w(),o=p(""),e=p(!1),t=p(!1),u=d(()=>n.value.encryptLocales);let i=null;const c=()=>{i&&clearTimeout(i),e.value=!1,a("verify",o.value,t.value),O().then(()=>{e.value=!0,i=setTimeout(()=>{e.value=!1},1e3)})};return()=>s("div",{class:["vp-decrypt-layer",{expand:l.full||r.value.home}]},s("div",{class:"vp-decrypt-modal"},[s("div",{class:["vp-decrypt-hint",{tried:e.value}]},e.value?u.value.errorHint:s(_,{"aria-label":u.value.iconLabel})),s("div",{class:"vp-decrypt-input"},[s("input",{type:"password",value:o.value,placeholder:u.value.placeholder,onInput:({target:v})=>{o.value=v.value},onKeydown:({key:v})=>{v==="Enter"&&c()}})]),s("div",{class:"vp-remember-password"},[s("input",{type:"checkbox",value:t.value,onChange:()=>t.value=!t.value}),u.value.remember]),s("button",{type:"button",class:"vp-decrypt-submit",onClick:()=>c()},"OK")]))}});const P=()=>{const l=x();return d(()=>l.value.encrypt||{})},D="VUEPRESS_HOPE_GLOBAL_TOKEN",C=()=>{const l=P(),a=h(D,""),r=b(D,""),n=d(()=>{const{global:e=!1,admin:t=[]}=l.value;return e&&t.length>0}),o=d(()=>{if(n.value){if(a.value)return l.value.admin.some(e=>f(a.value,e));if(r.value)return l.value.admin.some(e=>f(r.value,e))}return!1});return{isEncrypted:n,isDecrypted:o,validate:(e,t=!1)=>{(t?a:r).value=e}}},y=(l="",a)=>!!l&&f(l,a),S="VUEPRESS_HOPE_PATH_TOKEN",F=()=>{const l=k(),a=P(),r=h(S,{}),n=b(S,{}),o=t=>R(a.value.config)?V(a.value.config).filter(u=>j(decodeURI(t),u)).sort((u,i)=>i.length-u.length):[],e=t=>{const u=o(t);if(u.length>0){const{config:i={}}=a.value;return{isEncrypted:!0,isDecrypted:u.some(c=>r.value[c]&&i[c].some(v=>y(r.value[c],v))||n.value[c]&&i[c].some(v=>y(n.value[c],v)))}}return{isDecrypted:!1,isEncrypted:!1}};return{status:d(()=>e(l.value.path)),getStatus:e,validate:(t,u=!1)=>{const{config:i={}}=a.value,c=o(l.value.path);for(const v of c)if(i[v].filter(L=>y(t,L))){(u?r:n).value[v]=t;break}}}};var I=m({name:"GlobalEncrypt",slots:Object,setup(l,{slots:a}){const{isDecrypted:r,isEncrypted:n,validate:o}=C(),e=G(),t=p(!1);return E(()=>{t.value=!0}),()=>s(e.value?H:K,()=>n.value?t.value?r.value?a.default():s(g,{full:!0,onVerify:o}):null:a.default())}}),M=m({name:"LocalEncrypt",slots:Object,setup(l,{slots:a}){const{status:r,validate:n}=F(),o=p(!1);return E(()=>{o.value=!0}),()=>{const{isEncrypted:e,isDecrypted:t}=r.value;return e?o.value?t?a.default():s(g,{full:!0,onVerify:n}):null:a.default()}}});export{I as GlobalEncrypt,M as LocalEncrypt};
//# sourceMappingURL=export.js.map
